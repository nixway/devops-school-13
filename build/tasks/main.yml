---
# tasks file for boxfuse
- name: Ensure git package is present
  ansible.builtin.package:
    name: git
    state: present
  become: yes

- name: Download project files
  ansible.builtin.git:
    repo: 'https://github.com/venkaDaria/puzzle15.git'
    dest: "{{ project_dir }}"

- name: Patch pom.xml
  ansible.builtin.blockinfile:


- name: Copy Dockerfile to {{ project_dir }}
  ansible.builtin.copy:
    src: Dockerfile
    dest: "{{ project_dir }}"

#- name: Login to Docker Hub
#  community.docker.docker_login:
#    registry_url: "{{ registry_url }}"
#    username: "{{ docker_login }}"
#    password: "{{ docker_pass }}"
#    reauthorize: true # Re-authenticate even if credentials exist

- name: Build docker image
  ansible.builtin.command:
    cmd: "docker build -t {{ docker_image_name }}:{{ docker_image_tag }} {{ project_dir }}"
    chdir: "{{ project_dir }}"

#- name: Push a docker image
#  community.docker.docker_image_push:
#    name: "{{ docker_image_name }}:{{ docker_image_tag }}"
#    tag: latest

- name: Push a docker image
  ansible.builtin.command:
    cmd: "docker push {{ docker_image_name }}:{{ docker_image_tag }}"
    chdir: "{{ project_dir }}"
